<!DOCTYPE html>
<html lang="en">
<head>
    <meta name=viewport content="width=device-width, initial-scale=1, user-scalable=0, viewport-fit=cover">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache">
<!--    <link rel="shortcut icon" href="images/main-logo.png">-->
    <link rel="stylesheet" type="text/css" href="/css/core.css" media="only screen">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <title>모두의 사물함</title>
</head>
<body>
<div class="container">
    <main class="flex-column justify-content-between" style="padding-top:10%">
        <div>
            <div class="back-icon" role="button" onclick="Page.back()"></div>
            <div class="signup-title fs-24" style="margin-top:58px">기본정보 입력하기</div>
            <div class="d-flex flex-column gap-2" style="margin-top:64px">
                <label class="fs-18" for="name">이름</label>
                <input onkeypress="nextFocus(event)" class="fs-14" id="name" name="name" type="text" placeholder="이름 입력" style="padding:15px;border-radius:8px;border:1px solid #BFC2CE">
            </div>
            <div class="d-flex flex-column gap-2" style="margin-top:28px">
                <label class="fs-18" for="phone">전화번호</label>
                <div class="d-flex justify-content-between fs-14" id="phone">
                    <input maxlength="3" name="numStart" style="width:30%;padding:10px 14px;height:max-content;border-radius:8px;border:1px solid #BFC2CE" type="number">
                    <input maxlength="4" name="numMiddle" style="width:30%;padding:10px 14px;height:max-content;border-radius:8px;border:1px solid #BFC2CE" type="number">
                    <input maxlength="4" name="numEnd" onkeypress="nextFocus(event)" class="2" style="width:30%;padding:10px 14px;height:max-content;border-radius:8px;border:1px solid #BFC2CE" type="number">
                </div>
            </div>
            <div class="d-flex" style="margin-top:64px">
                <label class="fs-18 col-2 my-auto" for="departmentNum">학번</label>
                <input id="departmentNum" name="departmentNum" class="w-100 fs-14" type="number" placeholder="학번 입력하기" style="padding:15px;border-radius:8px;border:none;background-color:#F4F5FC">
            </div>
            <div class="d-flex justify-content-between" style="margin-top:56px">
                <label class="fs-18 col-2 my-auto" for="grade">학년</label>
                <select class="col-3 fs-14" id="grade" name="grade" style="padding:15px;border-radius:8px;border:1px solid #BFC2CE">
                    <option>1학년</option>
                    <option>2학년</option>
                    <option>3학년</option>
                    <option>4학년</option>
                </select>
            </div>
            <div class="d-flex justify-content-between" style="margin-top:54px">
                <label class="fs-18 col-2 my-auto" for="gender">성별</label>
                <div id="gender">
                    <span>
                        남성  <input type="radio" class="fs-14" name="gender" value="male" checked>
                    </span>
                    <span style="margin-left:50px">
                        여성  <input type="radio" class="fs-14" name="gender" value="female">
                    </span>
                </div>
            </div>
            <div class="d-flex justify-content-between" style="margin-top:57px">
                <label class="fs-18 col-2" for="address">주소</label>
                <div id="address" class="d-flex flex-column gap-2">
                    <select id="metro" name="metro" onchange="renderCity()">
<!--                        <option name="incheon">인천광역시</option>-->
<!--                        <option name="daegu">대구광역시</option>-->
<!--                        <option name="seoul">서울특별시</option>-->
                    </select>
                    <select id="city" name="city">
                        <div>도시를 선택해주세요.</div>
<!--                        <option name="incheon">서구</option>-->
<!--                        <option name="daegu">남구</option>-->
<!--                        <option name="seoul">노원구</option>-->
                    </select>
                </div>
            </div>
            <div class="d-flex flex-column gap-3" style="margin-top:59px">
                <label class="fs-18 mt-2" for="pw">비밀번호</label>
                <input id="pw" onkeypress="nextFocus(event)" name="pw" class="w-100 fs-14" type="password" placeholder="비밀번호 입력" style="padding:15px;border-radius:8px;border:none;background-color:#F4F5FC">
                <input id="pw2" name="pw2" class="w-100 fs-14" type="password" placeholder="비밀번호 확인" style="padding:15px;border-radius:8px;border:none;background-color:#F4F5FC">
            </div>
            <div class="d-flex justify-content-between align-items-center" style="padding-bottom:10px;border-bottom:1px solid #CBCDD8">
                <div class="d-flex gap-3" style="margin-top:68px">
                    <input name="checkAll" onclick="checkedAll()" style="width:20px" type="checkbox">
                    <span class="fs-20">전체동의</span>
                </div>
                <i class="fs-26 ri-arrow-down-s-fill d-flex align-self-end" style="color: #2857CE"></i>
            </div>
            <div class="d-flex justify-content-between align-items-center" style="margin-top:20px">
                <div class="d-flex gap-3">
                    <input name="check1" style="width:16px" type="checkbox">
                    <span class="fs-12">모두의 사물함 서비스 이용약간 (필수)</span>
                </div>
                <div class="fs-26" style="color:#CBCDD8"><i class="ri-arrow-right-s-line"></i></div>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex gap-3">
                    <input name="check2" style="width:16px" type="checkbox">
                    <span class="fs-12">개인정보 수집 및 이용약간 (필수) </span>
                </div>
                <div class="fs-26" style="color:#CBCDD8"><i class="ri-arrow-right-s-line"></i></div>
            </div>
        </div>
        <div role="button" class="fs-18 text-center submit-btn" onclick="signup()" style="margin-top:78px">완료</div>
        <div class="d-flex justify-content-center" style="gap:23px;margin-top:13px">
            <div style="color:#686B7C">이미 계정이 존재하신가요?</div>
            <a class="fs-14" href="/index.html">로그인</a>
        </div>
    </main>

</div>
</body>
</html>
<script src="js/jquery-3.5.1.min.js"></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap.bundle.js"></script>
<script src="js/core.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        Page.init(location.pathname, init, {nolog: true});
    });
</script>
<script src="js/velocity.min.js"></script>
<script src="js/addr.js"></script>
<script type="text/javascript">
    var pagectx = {};
    function init(params) {
        pagectx = params;
        let signupForm = SessionStore.get('signupForm');
        let addrMetro = AddrKo.getMetroList();
        renderMetro(addrMetro);
        renderCity();
        if(signupForm == null){
            Dialog.alert('잘못된 접근입니다.',()=>{
                Page.go('/');
            });
        }
    }

    function renderMetro(metros){
        console.log(metros);
        for(const metro of metros){
            $('#metro').append(`<option name=${metro[0]}>${metro[1]}</option>`);
        }
    }

    function renderCity(){
        let metro = $('#metro')[0].value;
        let select;
        let metroLists = $('#metro>option');
        for(const metroOne of metroLists){
            if(metro == metroOne.value){
                select = $(metroOne).attr('name');
            }
        }
        let addrCitys = AddrKo.getCityList(select);
        $('#city *').remove();

        for(const city of addrCitys){
            $('#city').append(`<option name=${city[0]}>${city[1]}</option>`);
        }
    }

    function nextFocus(e){
        if(e.keyCode == 13){
            let input = e.target;
            let inputs = $('input');
            let index = inputs.index(input);
            if(inputs.length - index == 1){
                login();
            }else{
                inputs[index+1].focus();
            }
        }
    }

    function signup(){
            let signupForm = SessionStore.get('signupForm');
            console.log(signupForm);

            let name = $('input[name=name]').val().trim();
            let phone = $('input[name=numStart]').val().trim() + '-' + $('input[name=numMiddle]').val().trim() + '-' + $('input[name=numEnd]').val().trim();
            let studentId = $('input[name=departmentNum]').val().trim();
            let grade = $('select[name=grade]').val().trim();
            let gender;
            if($('input[name=gender]')[0].checked){
                gender = $('input[name=gender]')[0].value;
            }else{
                gender = $('input[name=gender]')[1].value;
            }
            //let addr = $('select[name=시]').val().trim() +' '+ $('select[name=구]').val().trim();
            let addr = 100000;
            let pw = $('input[name=pw]').val().trim();
            let pw2 = $('input[name=pw2]').val().trim();
            let id = signupForm.email;
            let department = signupForm.department;
            let uni = signupForm.uniName;
            let type = signupForm.userType;
            let check1 = $('input[name=check1]')[0].checked;
            let check2 = $('input[name=check2]')[0].checked;
            console.log(check1);
            console.log(check2);
            if(name == ""){
                Dialog.alert('이름을 입력하세요.',()=>{
                    $('input[name=name]').focus();
                });
                return;
            }
        if($('input[name=numStart]').val().trim() == "" || $('input[name=numMiddle]').val().trim() == "" || $('input[name=numEnd]').val().trim() == ""){
            Dialog.alert('전화번호를 입력하세요.',()=>{
                $('input[name=numStart]').focus();
            });
            return;
        }
        if(studentId == ""){
            Dialog.alert('학번을 입력하세요.',()=>{
                $('input[name=departmentNum]').focus();
            });
            return;
        }
        if(pw == ""){
            Dialog.alert('비밀번호를 입력하세요.',()=>{
                $('input[name=pw]').focus();
            });
            return;
        }
        if(pw2 == ""){
            Dialog.alert('비밀번호를 입력하세요.',()=>{
                $('input[name=pw2]').focus();
            });
            return;
        }
        if(pw != pw2){
            Dialog.alert('비밀번호가 일치하지 않습니다.',()=>{
                $('input[name=pw]').focus();
            });
            return;
        }
        if(check1 == false || check2 == false){
            Dialog.alert('약관동의를 모두 체크해주세요.',()=>{
                $('input[name=check1]').focus();
            });
            return;
        }
            let obj = {'name' : name, 'phoneNum' : phone, 'studentId' : studentId, 'grade' : grade, 'gender' : gender,'addr' : addr, 'pw' : pw, 'type': type, 'uniName' : uni, 'id' : id, 'department' : department}
            console.log(obj);


            /*
            *   0. url로 접근핳수도 있으니 session값에서 이전 페이지에서 받아오는 uniName,email등 값 없을 시 이전 페이지 이동
            *   1.addr -> addr.js통해서 값 가져오기
            *   2.signupSchool -> signupSchool2넘어갈 때 sessionStroage통해서 uni, depName, email값 넘기기,
            *   3.obj실제 값과 다른 값들 학번이 Departmanet라고 되어있는거같은데 변수명 수정 signup.jsp보고 바꿔줘
            *   4.onclick()으로 함수로 만들기 jquery로 해놓은 위에 코드 함수로 만들어서 관리해줘
            * */

            AJAX.call("jsp/signup.jsp", obj, function(data) {
                console.log(data.trim());
                if(data.trim() == 'OK'){
                    //OK -> 추가 완료
                    Page.go('/sdSignupFinish.html')
                }else{
                    //ER -> 에러 (reload하면 적은 값들 사라지니까 이거는 빼자 - 메세지만 출력)
                    Dialog.alert(data.message);
                }
            });
    }

    function checkedAll(){
        if($('input[name=checkAll]')[0].checked == true){
            $('input[name=check1]')[0].checked = true;
            $('input[name=check2]')[0].checked = true;
        }else{
            $('input[name=check1]')[0].checked = false;
            $('input[name=check2]')[0].checked = false;
        }
    }

    $('#phone>input').keypress(function(e){
        let item = e.target;
        console.log(item.maxLength);
        console.log(item.value.length+1);
        if(item.maxLength < item.value.length+1){
            let inputs = $('#phone>input');
            let index = inputs.index(item);
            console.log(inputs[index+1]);
            e.preventDefault();
            inputs[index+1].focus();
        }
    });
</script>